from cobalt_strike import CobaltStrike

from malduck import procmem

import json

# todo: start from telemetry data

# with open("cobalt_strike_sample.json", "r") as f:
#     raw = f.read()
#
# csdict = json.loads(raw)
# bytes_field = csdict['_source']['process']['Ext']['memory_region']['bytes_compressed']
# addr = csdict['_source']['Target']['process']['thread']['Ext']['start_address_bytes']

def test_from_file():
    with procmem.from_file("c11c5e62618500ad1225d5f9d6e8d65ca91526bc3a7ab527d635c8331286c106.bin") as p:
       mem:bytes = p.readv(addr=0)

    striker = CobaltStrike() # todo: this is throwing an error
    config:dict = striker.cobaltstrike(p=mem, addr=0)
    assert "cobaltstrike" in config

